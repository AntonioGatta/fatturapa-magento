<?php 
$fId  		= Mage::registry('efatt-invoice-id');
$lUrl 		= "*/sales_invoice/viewinvoicespage/invoice_id/" . $fId; 
$mUrl 		= Mage::helper('adminhtml')->getUrl($lUrl);
$fKey 		= Mage::getSingleton('core/session')->getFormKey(); 
$config   	= Mage::registry('efatt-config'); 
$cc   		= Mage::registry('efatt-cessionario-committente');
$currencies = Mage::registry('efatt-currencies');
$countryList = Mage::getResourceModel('directory/country_collection')->loadData()->toOptionArray(false);
$fJsonUrl	= Mage::getBaseUrl('js') . "/efatt/fatturaPA_1.2_schema.json";
$fXmlUrl	= Mage::getBaseUrl('js') . "/efatt/fatturaPA_1.2.hbs";

$json = file_get_contents($fJsonUrl);
$jsonDecoded = json_decode($json);
$json = $jsonDecoded->properties;

foreach ($json as $n1 => $n2) {
    echo "<pre>";
    var_dump($n2);
    echo "</pre>";
}

die;
?>

<div id="page:main-container">

<form method="post" action='<?php echo $mUrl; ?>'>

<div class="content-header">
    <table cellspacing="0">
        <tbody><tr>
            <td style="width:50%;"><h3 class="icon-head head-sales-invoice"><?php echo "Fattura " . $fId ?> </h3></td>
            <td class="form-buttons"><button  type="submit" class="scalable save" style=""><span><span><span>Genera Fattura Elettronica</span></span></span></button></td>
        </tr>
    </tbody></table>
</div>


<input name="form_key" type="hidden" value='<?php echo $fKey ?>' />

<div class="box">
    <!--Order Information-->
    <div class="entry-edit">
        <div class="entry-edit-head">
            <strong>Dati Trasmissione</strong>
        </div>
        <div class="fieldset">
            <table cellspacing="0" class="form-list">
            <tbody>
            <tr>
                <td class="label"><label>Id paese</label></td>
                <td class="value">
                <select name="DatiTrasmissione_IdTrasmittente_IdPaese">
                <?php foreach ($countryList as $c => $ca) { ?>
                <option <?php if($ca['value'] == 'IT') echo 'selected="selected"' ?> value="<?php echo $ca['value']; ?>"><?php echo $ca['value']; ?></option>
                <?php } ?>
				</td>
            </tr>
            <tr>
                <td class="label"><label>Id codice</label></td>
                <td class="value"><input type="text" name="DatiTrasmissione_IdTrasmittente_IdCodice"></td>
            </tr>
            <tr>
                <td class="label"><label>Progressivo Invio</label></td>
                <td class="value"><input type="text" name="DatiTrasmissione_ProgressivoInvio"></td>
            </tr>
            <tr>
                <td class="label"><label>Formato Trasmissione</label></td>
                <td class="value"><input type="text" name="DatiTrasmissione_FormatoTrasmissione"></td>
            </tr>
            <tr>
                <td class="label"><label>Codice Destinatario</label></td>
                <td class="value"><input type="text" name="DatiTrasmissione_CodiceDestinatario"></td>
            </tr>
            </tbody></table>
        </div>
    </div>

    <!-- cedente prestatore from config -->
    <?php foreach ($config as $key => $fields) { ?>
    <div class="entry-edit">
        <div class="entry-edit-head">
            <strong><?php echo $key?></strong>
        </div>
        <div class="fieldset">
            <table cellspacing="0" class="form-list">
            <tbody>
			<?php foreach ($fields as $field => $value) { ?>
			<tr>
                <td class="label"><label><?php echo $field ?></label></td>
                <td class="value"><input type="text" name="<?php echo $key . '_' . $field ?>" value="<?php echo $value ?>"></td>
            </tr>
			<?php } ?>
	</tbody></table>
        </div>
    </div>
	<?php } ?>


    <div class="entry-edit">
        <div class="entry-edit-head">
            <strong>Cessionario Committente - Dati Anagrafici - Id Fiscale IVA</strong>
        </div>
        <div class="fieldset">
            <table cellspacing="0" class="form-list">
            <tbody><tr>
                <td class="label"><label>Id Paese</label></td>
                <td class="value">
                <select name="CessionarioCommittente_DatiAnagrafici_IdFiscaleIVA_IdPaese">
                <?php foreach ($countryList as $c => $ca) { ?>
                <option <?php if($ca['value'] == 'IT') echo 'selected="selected"' ?> value="<?php echo $ca['value']; ?>"><?php echo $ca['value']; ?></option>
                <?php } ?>
				</td>
            </tr>
            <tr>
                <td class="label"><label>Id Codice</label></td>
                <td class="value"><input type="text" name="CessionarioCommittente_DatiAnagrafici_IdFiscaleIVA_IdCodice"></td>
            </tr>
            </tbody></table>
        </div>
    </div>

    <div class="entry-edit">
        <div class="entry-edit-head">
            <strong>Cessionario Committente - Dati Anagrafici - Anagrafica</strong>
        </div>
        <div class="fieldset">
            <table cellspacing="0" class="form-list">
            <tbody><tr>
                <td class="label"><label>Denominazione</label></td>
                <td class="value"><input type="text" name="CessionarioCommittente_DatiAnagrafici_Anagrafica_Denominazione" value="<?php echo $cc['company'] ?>"></td>
            </tr>
            <tr>
                <td class="label"><label>Nome</label></td>
                <td class="value"><input type="text" name="CessionarioCommittente_DatiAnagrafici_Anagrafica_Nome" value="<?php echo $cc['firstname'] ?>"></td>
            </tr>
            <tr>
                <td class="label"><label>Cognome</label></td>
                <td class="value"><input type="text" name="CessionarioCommittente_DatiAnagrafici_Anagrafica_Cognome" value="<?php echo $cc['lastname'] ?>"></td>
            </tr>
            </tbody></table>
        </div>
    </div>

        <div class="entry-edit">
        <div class="entry-edit-head">
            <strong>Cessionario Committente - Sede</strong>
        </div>
        <div class="fieldset">
            <table cellspacing="0" class="form-list">
            <tbody><tr>
                <td class="label"><label>Indirizzo</label></td>
                <td class="value"><input type="text" name="CessionarioCommittente_Sede_Indirizzo" value="<?php echo $cc['street'] ?>"></td>
            </tr>
            <tr>
                <td class="label"><label>CAP</label></td>
                <td class="value"><input type="text" name="CessionarioCommittente_Sede_CAP" value="<?php echo $cc['postcode'] ?>"></td>
            </tr>
            <tr>
                <td class="label"><label>Comune</label></td>
                <td class="value"><input type="text" name="CessionarioCommittente_Sede_Comune" value="<?php echo $cc['city'] ?>"></td>
            </tr>
            <tr>
                <td class="label"><label>Nazione</label></td>
                <td class="value"><input type="text" name="CessionarioCommittente_Sede_Nazione" value="<?php echo $cc['country_id'] ?>"></td>
            </tr>
            </tbody></table>
        </div>
    </div>

    <div class="entry-edit">
        <div class="entry-edit-head">
            <strong>Dati Generali - Dati Generali Documento</strong>
        </div>
        <div class="fieldset">
            <table cellspacing="0" class="form-list">
            <tbody><tr>
                <td class="label"><label>Tipo Documento</label></td>
                <td class="value"><input type="text" name="DatiGenerali_DatiGeneraliDocumento_TipoDocumento">
				<p class="note">tipologia del documento oggetto della trasmissione (fattura, acconto/anticipo su fattura, nota di credito, parcella â€¦).</p>
                </td>
            </tr>
            <tr>
                <td class="label"><label>Divisa</label></td>
                <td class="value">
                <select name="DatiGenerali_DatiGeneraliDocumento_Divisa">
                <?php foreach ($currencies as $s => $d) { ?>
                <option <?php if($s == "EUR") echo "selected='selected' " ?> value="<?php echo $s ?>"><?php echo $d ?></option>
                <?php } ?>
				</select>
            </tr>
            <tr>
                <td class="label"><label>Data</label></td>
                <td class="value"><input type="text" name="DatiGenerali_DatiGeneraliDocumento_Data" id="DatiGenerali_DatiGeneraliDocumento_Data"></td>
            </tr>
            <tr>
                <td class="label"><label>Numero</label></td>
                <td class="value"><input type="text" name="DatiGenerali_DatiGeneraliDocumento_Numero"></td>
            </tr>
            </tbody></table>
        </div>
    </div>



<!-- end page -->    
</div>

</form>
</div>


<script type="text/javascript">// <![CDATA[
Calendar.setup({
    inputField : 'DatiGenerali_DatiGeneraliDocumento_Data',
    ifFormat : '%Y-%m-%e',
    button : 'date_from_trig',
    align : 'Bl',
    singleClick : true
});
// ]]></script>

  
